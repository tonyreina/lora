[workspace]
authors = ["Tony Reina <tbreina@bu.edu>"]
channels = ["conda-forge"]
name = "lora"
description = "Using low-rank adaptation to fine tune an LLM for medical question & answers."
platforms = ["linux-64", "osx-64", "osx-arm64"]
version = "0.1.0"
license = "Apache-2.0"
license-file = "LICENSE"
readme = "README.md"
homepage = "https://tonyreina.github.io/lora/"
repository = "https://github.com/tonyreina/lora"

[tasks]
# Global tasks go here

[environments]
docs = ["docs"]
cuda = ["cuda"]
mac = ["mac"]

[dependencies]
# Common dependencies that don't require CUDA
python = ">=3.13.9,<3.14"
pillow = ">=12.1.0,<13"
pre-commit = ">=4.5.1,<5"
ruff = ">=0.14.10,<0.15"

[pypi-dependencies]
loguru = ">=0.7.3, <0.8"

[feature.cuda.system-requirements]
cuda = "12.0"

[feature.cuda.dependencies]
pytorch-gpu = "*"
transformers = ">=4.57.1,<5"
peft = ">=0.18.0,<0.19"
jupyter = ">=1.1.1,<2"
accelerate = ">=1.12.0,<2"
bitsandbytes = ">=0.49.0,<0.50"
datasets = ">=3.0.0"
flash-attn = ">=2.8.3,<3"

[feature.cuda.tasks]
train_model = { cmd = "python main.py train" }
use_model = { cmd = "python main.py inference" }

[feature.docs.dependencies]
mkdocs = ">=1.6.1,<2"
mkdocs-material = ">=9.7.1,<10"
pymdown-extensions = ">=10.20,<11"

[feature.docs.pypi-dependencies]
mkdocs-minify-plugin = ">=0.8.0, <0.9"

[feature.mac.dependencies]
pytorch = "*"
transformers = ">=4.57.1,<5"
peft = ">=0.18.0,<0.19"
jupyter = ">=1.1.1,<2"
accelerate = ">=1.12.0,<2"
datasets = ">=3.0.0"
# Note: bitsandbytes and flash-attn have limited macOS support
# bitsandbytes = ">=0.49.0,<0.50"  # Uncomment if macOS support improves
# flash-attn = ">=2.8.3,<3"       # Not available on macOS

[feature.mac.tasks]
train_model = { cmd = "python main.py train", description = "Train model using MPS (Apple Silicon) or CPU" }
use_model = { cmd = "python main.py inference", description = "Run inference using MPS (Apple Silicon) or CPU" }

[feature.docs.tasks]
build_docs = { cmd = "mkdocs build", description = "Build the documentation" }
serve_docs = { cmd = "mkdocs serve", description = "Build and serve the documentation locally" }
